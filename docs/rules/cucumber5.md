# 5本のきゅうり - ゲームルール仕様

## ルール要約

### 基本情報
- プレイ人数: 2-6人
- カード: 1-15を各4枚（計60枚）
- 目的: きゅうりを5本集めたら敗北

### 用語定義
- トリック: 全員が1枚ずつカードを出す1回のプレイ
- リード: トリックの最初にカードを出すこと
- フォロー: リードされたスートに従うこと
- きゅうり: 失点を表す単位

### ゲームの流れ
1. 全カードを均等配布（余りは除外）
2. 前回の敗者（初回はランダム）がリード
3. 時計回りでカードを出す
4. トリック勝者が次のリード権を得る
5. 手札がなくなったらラウンド終了
6. 最終トリックの敗者がきゅうりを受け取る

### フォロールール
- リードされた数字以上のカードを出す必要がある
- 出せない場合は任意のカードを出せる（必敗）
- 同じ数字の場合、後出しが勝つ

### 失点ルール
- 通常: 最終トリックの敗者が1本
- 特例: 最終トリックで最大値（場の最大）を出した場合2本
- 5本以上で敗北確定

## 前提・仮定（実装用）

### 明確化した仕様
1. カード「1」の扱い: 最弱カード（特殊能力なし）
2. 同値の扱い: 後出し勝利（最後に出したプレイヤーがトリック獲得）
3. 最大値の定義: その時点で場に出ている全カードの最大値
4. 配り残し: 2人(12枚)、3人(11枚)、4人(8枚)、5人(7枚)、6人(6枚)
5. 初回リード: 完全ランダム選出
6. トリック進行: 即座に勝者判定、カード回収

### 代替バリアント（将来実装）
- [ ] カード「1」最強ルール（15に勝つ）
- [ ] 7の特殊能力（次を強制的に最弱に）
- [ ] きゅうり上限変更（3本/7本）
- [ ] 同値は先出し勝ちルール

## UIへの落とし込み

### プレイ可能/不可能の表示
```javascript
// カード選択可能性の判定
canPlay(card) {
  if (isFirstCard) return true;
  if (card.value >= leadValue) return true;
  if (!hasValidCard) return true;
  return false;
}

// UI表現
- 選択可能: 通常表示 + ホバーで金縁
- 選択不可: opacity: 0.5 + cursor: not-allowed
- 必須選択: パルスアニメーション
```

### 同値最大の警告
- 最終トリックで最大値を選択時: 赤い警告枠 + "きゅうり2本！"のツールチップ
- 確認モーダル: 「本当に出しますか？（きゅうり2本）」

### 最終トリック演出
1. 開始時: 画面上部に「最終トリック！」バナー（1秒）
2. カード選択中: 場のカードに薄いきゅうりの透かし
3. 決着時: 
   - 敗者のカードを赤くハイライト
   - きゅうりアイコンが敗者に飛んでいく（0.5秒）
   - スコア更新アニメーション

### 墓地の帰属表示
- 各プレイヤーの外周に個別墓地エリア
- 獲得トリック数をバッジで表示
- ホバーで獲得カード一覧を表示

## CPU難易度設計

### Easy（初心者向け）
- ランダム選択（ルール違反しない範囲）
- 最終トリックの危険を考慮しない
- 思考時間: 0.5-1秒

### Normal（標準）
```javascript
score = baseValue
      - (isLastTrick ? maxPenalty * 10 : 0)
      + (willWinTrick ? 3 : 0)
      - (cardValue * 0.1)
```
- 最終トリックで最大値回避
- 中盤は低いカードを温存
- 思考時間: 1-2秒

### Hard（上級）
```javascript
score = baseValue
      - lastTrickRisk * 20
      + positionAdvantage * 5
      - futureCardUtility * 3
      + opponentPressure * 2
```
- カードカウンティング
- 相手の手札推測
- ポジション（順番）を考慮
- 思考時間: 2-3秒

### チューニング余地
- 評価関数の重み調整
- 先読み深度の変更
- ブラフ要素の追加（Hardのみ）
- 学習による最適化（プレイログ分析）